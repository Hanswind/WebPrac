# 17. 리덕스 라이브러리

#### [리덕스]

----

: 가장 많이 사용하는 **리액트 상태 관리 라이브러리**

: 전역 상태 관리할때 굉장히 효과적

: Context API 통해 똑같은 작업 수행가능 (리액트 v16.3 이후 개선되었기에 그전에는 리덕스 주로 사용)

<br>

#### [리액트 기본 개념]

----

1. **액션(Action)**

   : **상태에 어떤한 변화가 필요할때 발생하는 것**

   : 객체 형태로 표현

   ```json
   // 액션 객체 형식
   {
   	type : 'TOGGLE_VALUE'    // 타입 : 객체의 이름
   }
   ```

   ```
   {
   	type : 'ADD_TODO',
   	data : {
   		id : 1,
   		text : '리덕스 배우기'
   	}
   }
   
   {
   	type : 'CHANGE_INPUT',
   	text : '안녕하세요'
   }
   ```

   - **타입** : 객체의 이름
   - **그외** : 나중에 상태 업데이트 할때 참고해야 할 값

   <br>

2. **액션 생성 함수**

   : 액션 객체를 만들어주는 함수

   ```js
   // 액션 생성 함수 예제
   function addTodo(data) {   // const addTodo = data => ({...
   	return {
   		type : 'ADD_TODO',
   		data
   	};
   }
   ```

   : **어떤 변화 일으켜야할때마다 액션 객체 만들어야 하는데 그 과정을 함수로 만들어 관리**

   <br>

3. **리듀서(reducer)**

   : 변화를 일으키는 함수

   : **액션을 만들어서 발생시키면 리듀서가 현재 상태와 전달 받은 액션 객체를 파라미터로 받아온다**.

   : **그리고 두 값을 참고해 새로운 상태로 만들어 반환**

   ```js
   const initialState = {
   	counter : 1
   };
   
   function reducer(state = initialState, action) {
   	switch (action.type) { 
   		case INCREMENT:  // 받아온 action(type)이 INCREMENT일때, 
   			return {
   				counter: state.counter + 1   // 받아온 state값 새로운 상태로 변환
   			}
   		default:
   			return state;
   	}
   }
   ```

   <br>

4. **스토어**

   <img src="https://i.imgur.com/c6A4cHg.png" alt="img" style="zoom:50%;" />

   : 프로젝트에 리덕스를 적용하기 위해 스토어를 만든다.

   : **한개의 프로젝트는 단 하나의 스토어**

   : **스토어 안에는 현재 애플리케이션의 상태와 리듀서가 들어가 있고, 그 외 몇가지 중요 내장 함수 지닌다**

   <br>

5. **디스패치**

   <img src="https://i.imgur.com/1e4ltmz.png" alt="img" style="zoom:50%;" />

   : 스토어의 내장 함수중 하나

   : **액션을 발생시키는 것**

   : 호출되면 스토어는 리듀서 함수를 실행시켜서 새로운 상태를 만든다.

   <br>

6. **구독**

   <img src="https://i.imgur.com/uROrrOc.png" alt="img" style="zoom:50%;" />

   : 스토어의 내장 함수중 하나

   : 해당 함수 안에 리스너 함수를 파라미터로 넣어 호출해주면, 이 리스너 함수가 액션이 디스패치되어 상태가 업데이트 될때마다 호출

   ```js
   const listener = () => {
   	console.log('상태가 업데이트 됨')
   }
   
   const unsubscribe = store.subscribe(listener);
   
   unsubscribe();  // 추후 구독 비활성화 할때 함수 호출
   ```

   <img src="https://i.imgur.com/FkqTNhu.png" alt="img" style="zoom:50%;" />

<br>

#### [리덕스 사용 방법 정리]

----

![img](https://3.bp.blogspot.com/-q5PcPlVyLl0/XFuAIZ0XOgI/AAAAAAAAKW0/9OhXmqCJ1yoAzfr5UQqiropDe2IC-Hz4QCLcBGAs/s640/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2019-02-07%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB%2B9.47.14.png)

1. **상태 변화가 필요할때 '액션'을 스토어에 전달 ( = 디스패치 과정)**

   

2. **스토어내 리듀서는 전달 받은 액션 기반으로 상태 어떻게 변화시킬지 결정**

   :**`스토어 = app의 state들 + 리듀서 + 내장 함수`** 로 구성.

   

3. **리듀서를 통해 상태 변화후, 스토어에 새 상태를 저장한다**

   

4. **스토어의 상태 바뀌면 이거 구독하고 있던 컴포넌트에 바로 전달한다**

   : 스토어에 있는 state 값 필요한 컴포넌트가 구독해놓음

<br>

#### [리액트 없이 쓰는 리덕스]

----

: **리덕스는 리액트에 종속되는 라이브러리가 아니고 다른 라이브러리/프레임워크에서도 사용 가능하다**

  ( Vue, 바닐라 자바스크립트 등에서 사용 가능)

<br>

#### [바닐라 자바스크립트에서 리덕스 사용하기]

-----

1. **빠른 프로젝트 구성을 위한 Parcel 도구 사용**

   : 이하 생략

<br>

#### [리덕스의 세가지 규칙]

----

1. **단일 스토어**

   : **하나의 애플리케이션 안에는 하나의 스토어만**

   : 여러개 사용 가능하긴하지만, 상태관리 더 복잡해지므로 권장하지 않음..

   <br>

2. **읽기 전용 상태**

   : 리덕스도 기존 setState, immer, spread 연산자때처럼 **불변성 유지**를 위해 상태를 업데이트 할때 **기존 객체 건드리지 않고 새로운 객체 생성 필요**

   : 리덕스에서 내부적으로 데이터 변경 감지하는 방법이 **얕은 비교 검사** 여서, 위 방식 사용해야하고, 좋은 성능을 유지할 수 있는 이유이기도 하다.

   <br>

3. **리듀서는 순수한 함수**

   : **변화를 일으키는 리듀서 함수는 순수한 함수여야 한다**

   - **순수한 함수 조건**

     - 리듀서 함수는 이전 상태와 액션 객체를 파라미터로 받는다
     - 파라미터 외의 값에는 의존하면 안된다
     - 이전 상태는 절대 건드리지 않고, 변화를 준 새로운 상태 객체를 만들어서 반환한다
     - 똑같은 파라미터로 호출된 리듀서 함수는 언제나 똑같은 결과 값을 반환해야 한다

     <br>

   - **위와 같은 조건으로 인해 리듀서 작성 유의 사항**

     - 리듀서 한수 내부에서 랜덤 값 생성 X
     - Date 함수 사용해 현재 시간 가져오기 X
     - 네트워크 요청 X (같은 파라미터여도 다른 결과값)

     <br>

   : **금지된 작업은 리듀서 함수 밖에서 처리하기** (ex. 액션 생성과정, 리덕스 미들웨어 등의 과정에서 하기)