# 42(2). 레이어드 아키텍처 예제(2)

1. Maven 프로젝트 생성

   : archetypes로 webapp 선택 /package 명 : kr.or.connect / archi.. id : guestbook
   
   <br>
   
2. 프로젝트 내 자바폴더 생성

   : src - main - java 폴더

   <br>

3. Pom.xml에 필요한 라이브러리 추가

   - spring 사용위해 추가 
   - servlet, jsp, jstl 사용위한 라이브러리 추가
   - Spring JDBC transition 사용위한 라이브러리 추가
   - mysql 드라이버 사용위한 라이브러리 추가
   - data source 사용 위한 라이브러리 추가
   - jdk 1.8 사용위한 plugin 부분 추가

   - json 이용위한 jackson 라이브러리 추가

     ```
     <properties>
     	...
     	<!-- jackson -->
     	<jackson2.version>2.8.6</jackson.version>
     </properties>
     ```

   ```xml
   // POM.XML
   <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
       <modelVersion>4.0.0</modelVersion>
       <groupId>kr.or.connect</groupId>
       <artifactId>guestbook</artifactId>
       <packaging>war</packaging>
       <version>0.0.1-SNAPSHOT</version>
       <name>guestbook Maven Webapp</name>
       <url>http://maven.apache.org</url>
       
       <properties>
           <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
           <spring.version>4.3.5.RELEASE</spring.version>
           <!--  jackson  -->
           <jackson2.version>2.8.6</jackson2.version>
       </properties>
       
       <dependencies>
       
           <dependency>
               <groupId>junit</groupId>
               <artifactId>junit</artifactId>
               <version>3.8.1</version>
               <scope>test</scope>
           </dependency>
           
           <!--  Spring  -->
           <dependency>
               <groupId>org.springframework</groupId>
               <artifactId>spring-context</artifactId>
               <version>${spring.version}</version>
           </dependency>
           
           <dependency>
               <groupId>org.springframework</groupId>
               <artifactId>spring-webmvc</artifactId>
               <version>${spring.version}</version>
           </dependency>
           
           
           <!--  Servlet JSP JSTL  -->
           <dependency>
               <groupId>javax.servlet</groupId>
               <artifactId>javax.servlet-api </artifactId>
               <version>3.1.0</version>
               <scope>provided</scope>
           </dependency>
           
           <dependency>
               <groupId>javax.servlet.jsp</groupId>
               <artifactId>javax.servlet.jsp-api</artifactId>
               <version>2.3.1</version>
               <scope>provided</scope>
           </dependency>
           
           <dependency>
               <groupId>jstl</groupId>
               <artifactId>jstl</artifactId>
               <version>1.2</version>
           </dependency>
           
           
           <!--  spring jdbc & jdbc driver & connection pool  -->
           <dependency>
               <groupId>org.springframework</groupId>
               <artifactId>spring-jdbc</artifactId>
               <version> ${spring.version}</version>
           </dependency>
           
           <dependency>
               <groupId>org.springframework</groupId>
               <artifactId>spring-tx</artifactId>
               <version>${spring.version}</version>
           </dependency>
           
           <dependency>
               <groupId>mysql</groupId>
               <artifactId> mysql-connector-java</artifactId>
               <version>5.1.45</version>
           </dependency>
           
           
           <!--  basic data source  -->
           <dependency>
               <groupId>org.apache.commons</groupId>
               <artifactId>commons-dbcp2</artifactId>
               <version>2.1.1</version>
           </dependency>
           
           
           <!--  Jackson Module  -->
           <dependency>
               <groupId>com.fasterxml.jackson.core</groupId>
               <artifactId>jackson-databind</artifactId>
               <version>${jackson2.version}</version>
           </dependency>
           
           <dependency>
               <groupId>com.fasterxml.jackson.datatype</groupId>
               <artifactId>jackson-datatype-jdk8</artifactId>
               <version>${jackson2.version}</version>
           </dependency>
       </dependencies>
       
       <build>
           <plugins>
               <plugin>
                   <groupId>org.apache.maven.plugins</groupId>
                   <artifactId>maven-compiler-plugin</artifactId>
                   <version>3.6.1</version>
                   <configuration>
                       <source>1.8</source>
                       <target>1.8</target>
                   </configuration>
               </plugin>
           </plugins>
       </build>
   </project>
   ```

   <br>

4. **라이브러리 추가후 Update project **

   : 프로젝트 우클릭 - maven - update project

   <br>

5. **프로젝트 settings에서 facet 부분 지정하기**

   : 네비게이터 탭(안보이면 Window - show view.. ) - .setting - ....facet,,,, -

    "jst.web" 버전 2.3 => 3.1 로 수정해주기

   <br>

6. **이클립스 재시작**

   : 재시작후 적용잘되었는지 확인위해 properties - Project Facet 부분에서 Dynamic web Model 3.1로 제대로 바뀌었는지 확인.

   : **이 1~6 번까지 과정 프로젝트 생성할때 마다 귀찮으면, Dynamic web project로 생성후 Maven 프로젝트로 convert 하는 방법등 존재.**

   <br>

   ======================================= 프로젝트 생성 및 기본 설정 완료 ==================

7. **Config 파일들을 위한 패키지 생성**

   : kr.or.connect.guestbook.config

   <br>

8. **WebMvcContextConfiguration 클래스 생성**

   : WebMvcConfigurer 상속 (전 챕처에서 작성한 설명 참고)

   : **여기서 하는 작업들은 DispatcherSErvlet이 읽어들이는 설정(config)**

   <br>

9. **DBConfig 클래스 생성**

   : 데이터베이스에 관련된 설정으로 Spring JDBC가 읽어낼수 있다

   : **TransactionManagement Configuerer 구현**

   <br>

10. **ApplicationCofing 클래스 생성**

    : **dao나 service에 구현되어있는 컴포넌트들을 읽어오는 설정 파일**

    <br>

11. **web.xml 수정**

    : 내용에 

    ```
    <servlet-mapping>
    		<servlet-name>mvc</servlet-name>
    		<url-pattern>/</url-pattern>
    	</servlet-mapping>
    ```

    부분은 모든 요청을 다 받을 꺼라는 의미.

    그리고 모든 요청 받았을때, 

    ```
    <servlet-name>mvc</servlet-name>
    		<servlet-class>org.springframework.web.servlet.DispatcherServlet
    		</servlet-class>
    ```

    : DispatcherServlet이 다 받아 처리한다고 설정.

    : DispatcherServlet을 프론트 서블릿으로 등록 과정이었고 이것들을 사용할때 이런

    ```
    <init-param>
    			<param-name>contextClass</param-name>
    			<param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext
    			</param-value>
    		</init-param>
    ```

    : applicationContext를 이용할꺼라는 뜻.

    : 그리고 사용시

    ```
    <param-name>contextConfigLocation</param-name>
    			<param-value>kr.or.connect.guestbook.config.WebMvcContextConfiguration
    			</param-value>
    ```

    : WEbMvcContextConfiguration 참고하라고 까지 ㅇㅇ.

    ```xml
    <filter-name>encodingFilter</filter-name>
    		<filter-class>org.springframework.web.filter.CharacterEncodingFilter
    		</filter-class>
    		<init-param>
    			<param-name>encoding</param-name>
    			<param-value>UTF-8</param-value>
    		</init-param>
    		
    		<!-- 위의 필더 적용범위 설정 -->
    		<filter-mapping>
    			<filter-name>encodingFilter</filter-name>
    			<url-pattern>/*</url-pattern>
    		</filter-mapping>
    ```

    : 이건 한글 인코딩 위한 거

    ```
    레이어드 아키텍처의 특징 상
    설정 파일을 하나가 다 갖고 있게 하지 않고
    프레젠테이션 부분과 나머지 부분들을 분리시키게 하기 위해서
    지금 비즈니스 로직쪽에서 사용되는 DBConfig와 ApplicationConfig에 나누어 둠.
    
    그리고 이 부분을 읽어들일 수 있어야 하기 때문에
    web.xml에
    
    	<listener>
    		<listener-class>org.springframework.web.context.ContextLoaderListener
    		</listener-class>
    	</listener>
    	
    를 추가.
    listener는 어떤 특별한 이벤트가 발생했을때 동작.
    여기에 등록된 리스너는 ContextLoaderListener로 run on server 할때 Context가 로딩되며 
    이거 클래스를 수행하라는 뜻.
    ```

    <br>

12. **메인용 뷰 jsp 생성**

    : webapp - WEB-INF / views 디렉토리 생성

    : 내부에 index.jsp 생성

    : index.jsp는 "list"라는 요청으로 redirect 해준다.

    ```jsp
    // index.jsp
    
    <%@ page language="java" contentType="text/html; charset=UTF-8"
        pageEncoding="UTF-8"%>
    <% 
    	response.sendRedirect("list");
    %>
    ```

    : 여기까지 해서 실행하면 /guestbook/list 로 리다이렉트 확인가능 (페이지는 404 정상)

    <br>

    ================== **Config 파일들 레이어드 아키텍처 특성 살려 분리해서 구현** ===================

    <br>

13. 

