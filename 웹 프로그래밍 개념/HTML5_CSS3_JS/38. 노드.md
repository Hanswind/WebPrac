# 38. 노드

: JS를 서버에서 사용할 목적으로 만듬

: 웹 어플리케이션 개발 + 데스크톱 애플리케이션 개발 + 시스템 스크립트 영역 등으로 확장

<br>

#### [1. 노드의 기초]

---

: 브라우저 기반 JS에서 노드에서 제공하는 API를 사용하는 방식

: 노드, npm 설치는 2장 참고해 설치

<br>

#### [2. 모듈]

----

: **패키지를 만들고 코드를 네임스페이스(이름충돌방지방법)로 구분하는 매커니즘**

ex) 서로 다른 사람이 만든 두 함수 이름이 동일(calculate)할때 구분하는 방법 제공 예제

```js
// amanda.js 파일
function calculate(a,x,n) {
	if (x === 1) return a*n;
	return a*(1-Math.pow(x, n)/(1 - x));
}
module.exports = caculate;
```

```js
// typer.js 파일
function calculate(r) {
	return 4/3*Math.PI*Math.pow(r, 3);
}
module.exports = calculate;
```

```js
const amanda_calculate = require('./amanda.js');
const tyler_calculate = require('./tyler.js');

console.log(amanda_calculate(1,2,5));  // 31
console.log(tyler_calculate(2));       // 33.51032...
```

: **require 사용해 불러올 모듈 선택가능 (동일한 변수명이라도 괜찮음)**

<br>

- **모듈은 어떤 타입의 값이든 내보낼 수 있다**

  ```
  module.exports = 함수, 변수, 문자열 등등 원시값 등 가능
  ```

  ```js
  // 모듈로 여러가지 기하학 함수 내보내기 예제
  module.exports = {
      geometricSum(a, x, n) {
          if(x === 1) return a*n;
          return a*(1-Math.pow(x,n))/(1-x);
      },
      arithmeticSum(n) {
          return (n + 1)*n/2;
      },
      quadraticFormula(a, b, c) {
          const D = Math.sqrt(b*b - 4*a*c);
          return [(-b + D)/(2*a), (-b -D)/(2*a)];
      },
  }
  
  // 다음과같이 exports 단축 문법 사용 가능 - 객체 내보낼때만 사용 가능 (함수, 기타값은 불가능), 섞어쓰기 불가능
  exports.gemetricSum = function(a, x, n) {
      ...
  };
  exports.arithmeticSum = function(n){
      ...
  };
  export.quadraticFormula = function(a,b,c) {
      ...
  }
  ```

  ```js
  const amanda = require('./amanda.js');
  console.log(amanda.geometricSu,(1,2,5));   // logs 31
  console.log(amanda.quadraticFormula(1,2,-15));  // logs [3, -5]
  ```

<br>

#### [3. 모듈의 구분]

----

: 모듈은 **코어 모듈, 파일 모듈, npm 모듈** 세가지로 구별

: **require 함수** 사용하면 노드는 함수의 매개변수를 보고 어떤 타입인지 판단.

- **코어 모듈**

  : fs나 os처럼 **노드 자체에서 제공하는 모듈**. 이들은 모두 예약어

- **파일 모듈**

  : 위에서 본 **module.exports**에 할당되는 파일 만들고 그 파일 불러옴

- **npm 모듈**

  : 특별한 디렉터리 node_modules에 저장되는 모듈 파일

```js
// 모듈 타입 예제

// 1. 코어 모듈 - 매개변수 : /, ./, ../ 등으로 시작하지 않는다
require('fs')
require('os')
require('http')
require('child_process')

// 2. 파일 모듈 : 매개변수 /, ./, ../ 등으로 시작
require('./debug.js')
require('/full/path/to/module.js')
require('../a.js')

// 3. npm 모듈
require('debug')
require('express')
require('koa')
require('q')
```

<br>

- **코어 모듈 정리**

  | 모듈          | 전역 여부 | 설명                                          |
  | ------------- | --------- | --------------------------------------------- |
  | assert        | 아님      | 테스트 목적으로 사용                          |
  | buffer        | 전역      | 입출력 I/O 작업에 사용 (주로 파일과 네트워크) |
  | child_process | 아님      | 외부 프로그램 실행시 필요한 함수              |
  | 생략          | 생략      | 생략...                                       |

  : 이외에 여러 모듈들 있지만 생략. (**[노드 API 문서 참고](https://nodejs.org/api/)**)

  <br>

- **npm 모듈 정리**

  : 특수한 이름 표기법을 사용하는 파일 모듈

  : 모듈 x를 가져올때, x가 코어 모듈 이름 아니면 노드는 먼저 현재 디렉토리에 node_modules 서브디렉토리가 있는지 확인. 있으면 그 안에서 x를 찾음

  : 못찾으면 부모 디렉터리로 올라가서 node_modules 서브디렉터리가 있는지, 있다면 모듈 x가 있는지 확인

  : 모듈 찾거나 루트 디렉터리에 도달할때까지 이 과정 반복

  ```
  // 예제 :프로젝트위치 - home/jdoe/test_project 에 있고 애플리케이션 파일에서 require('x') 호출
  
  // 노드가 모듈 x 탐색 순서
  home/jdoe/test_project/node_modules/x
  home/jdoe/node_modules/x
  home/node_modules/x
  /node_modules/x
  ```

  : **대부분 프로젝트에는 애플리케이션 루트에 node_modules 디렉터리 하나 있음**

  : node_modules 디렉터리에 **직접 추가, 제거는 금지**

  : 모듈 파일 관련 작업은 **모두 npm에서** 해야한다.

  : **직접 작성한 모듈을 node_modules에 저장 X**

   ㄴ 동작은 하지만 node_modules 삭제되더라도 package.json 파일에 기록된 의존성 리스트를 통해 다시 설치 가능

<br>

#### [4. 함수 모듈을 통한 모듈 커스터마이징]

----

: 모듈은 대부분 객체 내보내지만, **가끔 함수 하나만 내보낼 때**도 있다

: 이 경우는 **그 모듈의 함수를 즉시 호출하려는 의도로 만들때가 대부분**

: 사용하려는 것이 함수의 반환값.

: 이런 패턴은 **모듈을 일부 커스터마이즈 하거나, 주변 컨텍스트에서 정보를 얻어야 할때 주로 사용**

- npm 패키지의 debug

  ```js
  // debug 임포트할때는 문자열 매개변수를 하나 넘긴다
  const debug = require('debug')('main');   // 모듈이 반환하는 함수를 즉시 호출 가능
  
  debug("starting");   // 디버그 활성화되어 있으면 "main starting +0ms" 라는 로그를 남김
  ```

  : debug 모듈이 반환한 것을 즉시 호출 = debug 모듈이 함수를 반환

  : 반환 값인 함수 역시 함수를 반환

  ...생략

: **노드는 노드 앱을 실행할때 어떤 모듈이든 단 한번만 임포트 (안전, 권장되는 방식)**

<br>

#### [5. 파일시스템 접근]

----

